# azure-pipelines.yml

trigger:
- main  # Ejecuta este pipeline cada vez que haya un push a la rama 'main'

pool:
  vmImage: 'ubuntu-latest' # Usa una m치quina virtual con Ubuntu

steps:
- task: NodeTool@0
  inputs:
    versionSpec: '18.x' # Especifica la versi칩n de Node.js que usa tu proyecto
  displayName: 'Install Node.js 18'

- script: |
    npm ci
  displayName: 'Install dependencies (npm ci)'

- script: |
    npx playwright install --with-deps
  displayName: 'Install Playwright browsers'

# Este paso ahora es m치s simple, sin el bloque 'env'
- script: |
    npm test
  displayName: 'Run Playwright tests'

- task: PublishTestResults@2
  inputs:
    testResultsFormat: 'JUnit'
    testResultsFiles: 'test-results/results.xml' # Ruta del archivo que definimos en playwright.config.js
    mergeTestResults: true
    failTaskOnFailedTests: true # Hace que el pipeline falle si alguna prueba falla
  displayName: 'Publish Test Results'
  condition: always() # Ejecuta este paso siempre, incluso si el paso 'npm test' fall칩
